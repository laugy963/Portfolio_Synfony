{% extends 'base.html.twig' %}

{% block title %}Portfolio - Accueil{% endblock %}

{% block main_class %}{% endblock %}

{% block body %}
    <!-- Section bannière avec images -->
    <section class="hero-banner" style="margin-top: -90px; padding-top: 76px;">
        <div id="carouselBanner" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#carouselBanner" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#carouselBanner" data-bs-slide-to="1" aria-label="Slide 2"></button>
                <button type="button" data-bs-target="#carouselBanner" data-bs-slide-to="2" aria-label="Slide 3"></button>
            </div>
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="{{ asset('images/banners/banner-2-home.png') }}" class="d-block w-100" alt="Banner 1" style="height: 100vh; object-fit: cover;">
                </div>
                <div class="carousel-item">
                    <img src="{{ asset('images/banners/banner-1-home.png') }}" class="d-block w-100" alt="Banner 2" style="height: 100vh; object-fit: cover;">
                </div>
                <div class="carousel-item">
                    <img src="{{ asset('images/banners/banner-3-home.png') }}" class="d-block w-100" alt="Banner 3" style="height: 100vh; object-fit: cover;">
                </div>
            </div>
        </div>
        
        <!-- Titre centré sur la bannière -->
        <div class="hero-content">
            <div class="container text-center">
                <h1 class="display-2 fw-bold text-white mb-4">Bienvenue sur Mon Portfolio</h1>
                <p class="lead text-white mb-4">Développeur passionné par la création d'expériences web exceptionnelles</p>
                <div class="hero-buttons">
                    <a href="#projects" class="btn btn-primary btn-lg me-3">Voir mes projets</a>
                    <a href="#contact" class="btn btn-outline-light btn-lg">Me contacter</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Section À propos -->
    <section id="about" class="py-5 about-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto text-center">
                    <h2 class="display-4 mb-4">À propos de moi</h2>
                    <p class="lead mb-4">Développeur web passionné avec une expertise en Symfony, JavaScript et technologies modernes. Je crée des applications web robustes et élégantes.</p>
                    <div class="skills-badges mt-4">
                        <span class="badge skill-badge me-2 mb-2">Symfony</span>
                        <span class="badge skill-badge me-2 mb-2">JavaScript</span>
                        <span class="badge skill-badge me-2 mb-2">PHP</span>
                        <span class="badge skill-badge me-2 mb-2">CSS3</span>
                        <span class="badge skill-badge me-2 mb-2">HTML5</span>
                        <span class="badge skill-badge me-2 mb-2">Bootstrap</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section Projets -->
    <section id="projects" class="py-5 bg-light">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center mb-5">
                    <h2 class="display-4 mb-4">Mes Projets</h2>
                    <p class="lead">Découvrez quelques-unes de mes réalisations</p>
                </div>
            </div>
            <div class="row">
                {% if projects is empty %}
                    <div class="col-12">
                        <p class="text-muted text-center py-5">
                            <i class="fas fa-folder-open fa-3x mb-3 d-block text-secondary"></i>
                            Aucun projet pour le moment.
                        </p>
                    </div>
                {% else %}
                    {% for project in projects %}
                        <div class="col-md-4 mb-4">
                            <div class="card h-100">
                                {% if project.bannerImage %}
                                    <img src="{{ asset('uploads/images/' ~ project.bannerImage) }}" class="card-img-top" alt="{{ project.title }}" style="height: 200px; object-fit: cover;">
                                {% else %}
                                    <img src="{{ asset('images/projects/default.png') }}" class="card-img-top" alt="Default" style="height: 200px; object-fit: cover;">
                                {% endif %}
                                <div class="card-body">
                                    <h5 class="card-title">{{ project.title }}</h5>
                                    <p class="card-text">{{ project.smallDescription }}</p>
                                    <a href="{{ path('project_public_show', {id: project.id}) }}" class="btn btn-primary">Voir le projet</a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </section>

    <!-- Section Contact -->
    <section id="contact" class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto text-center">
                    <h2 class="display-4 mb-4">Me contacter</h2>
                    <p class="lead mb-4">N'hésitez pas à me contacter pour discuter de vos projets</p>
                    <div class="d-flex justify-content-center gap-3">
                        <a href="mailto:contact@example.com" class="btn btn-primary">Email</a>
                        <a href="#" class="btn btn-outline-primary">LinkedIn</a>
                        <a href="#" class="btn btn-outline-primary">GitHub</a>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Éléments de la navbar
            const navbar = document.querySelector('.navbar');
            const navbarToggler = document.querySelector('.navbar-toggler');
            const navbarCollapse = document.querySelector('.navbar-collapse');
            const navLinks = document.querySelectorAll('.nav-link[href^="#"]');
            
            // ========== SMOOTH SCROLL AVEC FERMETURE AUTO DU MENU ==========
            navLinks.forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const target = document.querySelector(targetId);
                    
                    if (target) {
                        // Fermer le menu mobile automatiquement
                        if (navbarCollapse.classList.contains('show')) {
                            const bsCollapse = bootstrap.Collapse.getInstance(navbarCollapse);
                            if (bsCollapse) {
                                bsCollapse.hide();
                            }
                        }
                        
                        // Scroll fluide avec offset pour la navbar fixe
                        const navbarHeight = navbar.offsetHeight;
                        const offsetTop = target.offsetTop - navbarHeight - 20;
                        
                        window.scrollTo({
                            top: offsetTop,
                            behavior: 'smooth'
                        });
                        
                        // Ajouter une classe active temporaire
                        navLinks.forEach(link => link.classList.remove('current-section'));
                        this.classList.add('current-section');
                    }
                });
            });
            
            // ========== EFFET DE TRANSPARENCE AU SCROLL ==========
            let lastScrollTop = 0;
            let ticking = false;
            
            function updateNavbar() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                // Effet de transparence
                if (scrollTop > 50) {
                    navbar.classList.add('navbar-scrolled');
                } else {
                    navbar.classList.remove('navbar-scrolled');
                }
                
                // Auto-hide sur mobile en scrollant vers le bas
                if (window.innerWidth <= 768) {
                    if (scrollTop > lastScrollTop && scrollTop > 100) {
                        // Scrolling down & past navbar height
                        if (!navbarCollapse.classList.contains('show')) {
                            navbar.style.transform = 'translateY(-100%)';
                            navbar.style.transition = 'transform 0.3s ease';
                        }
                    } else {
                        // Scrolling up
                        navbar.style.transform = 'translateY(0)';
                    }
                }
                
                lastScrollTop = scrollTop;
                ticking = false;
            }
            
            window.addEventListener('scroll', function() {
                if (!ticking) {
                    requestAnimationFrame(updateNavbar);
                    ticking = true;
                }
            });
            
            // ========== FERMETURE DU MENU MOBILE ==========
            
            // Fermer en cliquant à l'extérieur
            document.addEventListener('click', function(e) {
                if (window.innerWidth <= 991.98) {
                    const isClickInsideNav = navbar.contains(e.target);
                    const isMenuOpen = navbarCollapse.classList.contains('show');
                    
                    if (!isClickInsideNav && isMenuOpen) {
                        const bsCollapse = bootstrap.Collapse.getInstance(navbarCollapse);
                        if (bsCollapse) {
                            bsCollapse.hide();
                        }
                    }
                }
            });
            
            // Fermer avec la touche Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && navbarCollapse.classList.contains('show')) {
                    const bsCollapse = bootstrap.Collapse.getInstance(navbarCollapse);
                    if (bsCollapse) {
                        bsCollapse.hide();
                    }
                }
            });
            
            // ========== GESTION TACTILE POUR MOBILE ==========
            let touchStartY = 0;
            let touchEndY = 0;
            
            navbar.addEventListener('touchstart', function(e) {
                touchStartY = e.touches[0].clientY;
            }, { passive: true });
            
            navbar.addEventListener('touchend', function(e) {
                touchEndY = e.changedTouches[0].clientY;
                const touchDiff = touchStartY - touchEndY;
                
                // Swipe vers le haut pour fermer le menu
                if (touchDiff > 50 && navbarCollapse.classList.contains('show')) {
                    const bsCollapse = bootstrap.Collapse.getInstance(navbarCollapse);
                    if (bsCollapse) {
                        bsCollapse.hide();
                    }
                }
            }, { passive: true });
            
            // ========== GESTION DU RESIZE DE FENÊTRE ==========
            window.addEventListener('resize', function() {
                // Réinitialiser les styles de la navbar sur desktop
                if (window.innerWidth > 768) {
                    navbar.style.transform = 'translateY(0)';
                    navbar.style.transition = '';
                }
                
                // Fermer le menu si on passe en mode desktop
                if (window.innerWidth > 991.98 && navbarCollapse.classList.contains('show')) {
                    const bsCollapse = bootstrap.Collapse.getInstance(navbarCollapse);
                    if (bsCollapse) {
                        bsCollapse.hide();
                    }
                }
            });
            
            // ========== AMÉLIORATION ACCESSIBILITÉ ==========
            
            // Navigation au clavier dans le menu
            navbarToggler.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    this.click();
                }
            });
            
            // Focus management pour le menu mobile
            navbarCollapse.addEventListener('shown.bs.collapse', function() {
                const firstNavLink = this.querySelector('.nav-link');
                if (firstNavLink) {
                    firstNavLink.focus();
                }
            });
            
            // ========== HIGHLIGHT DU LIEN ACTIF AU SCROLL ==========
            const sections = ['about', 'projects', 'contact'];
            
            function highlightActiveSection() {
                const scrollPos = window.scrollY + navbar.offsetHeight + 100;
                
                sections.forEach(sectionId => {
                    const section = document.getElementById(sectionId);
                    const navLink = document.querySelector(`a[href="#${sectionId}"]`);
                    
                    if (section && navLink) {
                        const sectionTop = section.offsetTop;
                        const sectionBottom = sectionTop + section.offsetHeight;
                        
                        if (scrollPos >= sectionTop && scrollPos < sectionBottom) {
                            navLinks.forEach(link => link.classList.remove('current-section'));
                            navLink.classList.add('current-section');
                        }
                    }
                });
            }
            
            window.addEventListener('scroll', highlightActiveSection);
            
            console.log('🎯 Navigation responsive initialisée avec succès !');
        });
    </script>
{% endblock %}
